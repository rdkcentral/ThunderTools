string message;

ASSERT(_service == nullptr);
ASSERT(service != nullptr);
{{ASSERT_IMPL}}
ASSERT(_connectionId == 0);

_service = service;
_service->AddRef();
{{REGISTER_NOTIFICATION}}

_impl{{COMRPC[1:]}} = service->Root<Exchange::{{FIRST_COMRPC_INTERFACE}}>(_connectionId, timeout, _T("{{PLUGIN_NAME}}Implementation"));
if (_impl{{COMRPC[1:]}} == nullptr) {
    message = _T("Couldn't create instance of _impl{{COMRPC[1:]}}");
} else {
    {{NESTED_QUERY}}
}

return (message);